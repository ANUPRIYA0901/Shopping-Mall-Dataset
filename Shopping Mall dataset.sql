CREATE DATABASE PRACTICE;

CREATE TABLE MALL (
    SHOP_NAME VARCHAR(100),
    CAFE_NAME VARCHAR(100),
    RESTAURANT_NAME VARCHAR(100),
    RENT DECIMAL(10,2),
    OPENING_YEAR INT,
    NUMBER_OF_EMPLOYEES INT,
    TOTAL_SALARIES DECIMAL(12,2),
    TOTAL_ELECTRICITY_BILLS DECIMAL(12,2)
);
INSERT INTO MALL
(SHOP_NAME, CAFE_NAME, RESTAURANT_NAME, RENT, OPENING_YEAR, NUMBER_OF_EMPLOYEES, TOTAL_SALARIES, TOTAL_ELECTRICITY_BILLS)
VALUES
('MEGAMART', 'CAFE MOCHA', 'SPICE HUB', 50000, 2015, 20, 400000, 15000),
('STYLESTORE', 'BREW HOUSE', 'FOODIES DEN', 35000, 2018, 12, 200000, 10000),
('TECHWORLD', 'CHOCO CAFE', 'ROYAL TREAT', 60000, 2012, 25, 600000, 25000),
('BOOKBARN', 'BEAN SPOT', 'TANDOORI TALES', 25000, 2019, 8, 120000, 7000),
('FRESHMART', 'CAFE AROMA', 'VEGGIE VILLA', 40000, 2016, 15, 300000, 12000),
('HOMENEEDS', 'LATTE LOUNGE', 'GRILL MASTER', 30000, 2014, 10, 150000, 9000),
('FASHIONHUB', 'MOCHA MAGIC', 'CURRY PALACE', 45000, 2017, 18, 360000, 14000),
('DAILYMART', 'DAILY BREW', 'URBAN BITES', 28000, 2020, 9, 110000, 8000);

-- SELECT
SELECT * FROM MALL;
-- ALTER
ALTER TABLE MALL CHANGE TOTAL_ELECTRICITY_BILLS ELECTRICITY_BILL DECIMAL;
-- UPDATE
UPDATE MALL SET RENT = 40000 
WHERE NUMBER_OF_EMPLOYEES = 12;

-- DELETE
DELETE FROM MALL 
WHERE OPENING_YEAR = 2012; 

-- ADDING NEW ROW
INSERT INTO MALL
(SHOP_NAME, CAFE_NAME, RESTAURANT_NAME, RENT, OPENING_YEAR, NUMBER_OF_EMPLOYEES, TOTAL_SALARIES, ELECTRICITY_BILL)
VALUES
('FUTUREMART', 'NEO CAFE', 'SKY DINE', 60000, 2025, 15, 350000, 18000);
SELECT * FROM MALL;

-- Find the shop with maximum employees.
SELECT * FROM MALL
ORDER BY NUMBER_OF_EMPLOYEES DESC
LIMIT 2;

-- Find the average rent of all businesses.
SELECT SUM(avg(RENT)) FROM MALL;

-- Get the total salaries paid by shops opened in 2018 or later.
SELECT TOTAL_SALARIES FROM MALL
WHERE OPENING_YEAR>=2018;

SELECT * FROM MALL;

-- Calculate average electricity bills by opening_year.
SELECT SHOP_NAME, AVG(ELECTRICITY_BILL), OPENING_YEAR FROM MALL
GROUP BY SHOP_NAME, OPENING_YEAR;

-- Find how many businesses opened each year.
SELECT OPENING_YEAR, COUNT(*) AS OPENED_BUSINESSES FROM MALL
GROUP BY OPENING_YEAR
ORDER BY OPENING_YEAR;

-- Rank shops by rent (highest first)
SELECT SHOP_NAME, RANK() OVER (ORDER BY RENT DESC) AS RANKING FROM MALL;

#WINDOW FUNCTIONS
-- Find the previous yearâ€™s salaries for each row (using LAG).
SELECT SHOP_NAME, RENT, TOTAL_SALARIES, OPENING_YEAR,
LAG(TOTAL_SALARIES,1) OVER (ORDER BY RENT) AS PREVIOUS_DATA FROM MALL;

SELECT SHOP_NAME, RENT, TOTAL_SALARIES, OPENING_YEAR,
LEAD(TOTAL_SALARIES,1) OVER (ORDER BY RENT) AS PREVIOUS_DATA FROM MALL;

#HAVING
-- List all years where the average electricity bill is greater than 12000.
SELECT OPENING_YEAR, SHOP_NAME, AVG(ELECTRICITY_BILL) AS AVG_BILL
FROM MALL
GROUP BY OPENING_YEAR, SHOP_NAME
HAVING AVG(ELECTRICITY_BILL) > 12000;

-- Find all opening years after 2014 where the average salaries are greater than 300,000.
SELECT OPENING_YEAR, SHOP_NAME, AVG(TOTAL_SALARIES) AS AVG_SALARY FROM MALL
WHERE OPENING_YEAR > 2014 
GROUP BY OPENING_YEAR, SHOP_NAME;

-- USING HAVING
SELECT OPENING_YEAR, SHOP_NAME, AVG(TOTAL_SALARIES) AS AVG_SALARY FROM MALL
WHERE OPENING_YEAR > 2014
GROUP BY OPENING_YEAR, SHOP_NAME
HAVING AVG(TOTAL_SALARIES)> 300000;




